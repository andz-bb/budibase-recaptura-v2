"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.params = exports.body = void 0;
const joi_1 = __importDefault(require("joi"));
function validate(schema, property) {
    // Return a Koa middleware function
    return (ctx, next) => {
        var _a;
        if (!schema) {
            return next();
        }
        let params = null;
        // @ts-ignore
        let reqProp = (_a = ctx.request) === null || _a === void 0 ? void 0 : _a[property];
        if (ctx[property] != null) {
            params = ctx[property];
        }
        else if (reqProp != null) {
            params = reqProp;
        }
        // not all schemas have the append property e.g. array schemas
        if (schema.append) {
            schema = schema.append({
                createdAt: joi_1.default.any().optional(),
                updatedAt: joi_1.default.any().optional(),
            });
        }
        const { error } = schema.validate(params);
        if (error) {
            ctx.throw(400, `Invalid ${property} - ${error.message}`);
            return;
        }
        return next();
    };
}
function body(schema) {
    return validate(schema, "body");
}
exports.body = body;
function params(schema) {
    return validate(schema, "params");
}
exports.params = params;
//# sourceMappingURL=joi-validator.js.map